<div class="container cf">
  <div class="page-header">
    <h1>
      <kds-icon-delivery size="xl"></kds-icon-delivery> Cars Listing page
    </h1>
    <ers-toolbar [isHorizontal]="true" tooltipPosition="below" style="display: inline-block">
      <ers-tool-button icon="kds-icon-upload" actionLabel="Import" (clicked)="executeAction($event, 'Upload')">
      </ers-tool-button>
      <ers-tool-button icon="kds-icon-plus" actionLabel="Add" (clicked)="executeAction($event, 'Add')">
      </ers-tool-button>
    </ers-toolbar>
  </div>

  <div class="row">
    <div class="col-md-12">
      <p-table #dt [value]="(page | async)?.data.cars" [rows]="paginatorOptions.itemsPerPage" [paginator]="true"
        [lazy]="true" [first]="first" [emptymessage]="'No records found.'" (onSort)="_sortHandler($event)">
        <ng-template pTemplate="header">
          <tr>
            <th [pSortableColumn]="'make'">
              Make
              <kds-icon-sort *ngIf="!_isFieldSorted('make')"></kds-icon-sort>
              <kds-icon-up-arrow *ngIf="_isFieldSorted('make') && _isAscendingSortOrder('make')"></kds-icon-up-arrow>
              <kds-icon-down-arrow *ngIf="_isFieldSorted('make') && !_isAscendingSortOrder('make')">
              </kds-icon-down-arrow>
            </th>
            <th [pSortableColumn]="'model'">Model
              <kds-icon-sort *ngIf="!_isFieldSorted('model')"></kds-icon-sort>
              <kds-icon-up-arrow *ngIf="_isFieldSorted('model') && _isAscendingSortOrder('model')"></kds-icon-up-arrow>
              <kds-icon-down-arrow *ngIf="_isFieldSorted('model') && !_isAscendingSortOrder('model')">
              </kds-icon-down-arrow>
            </th>
            <th [pSortableColumn]="'color'">Color
              <kds-icon-sort *ngIf="!_isFieldSorted('color')"></kds-icon-sort>
              <kds-icon-up-arrow *ngIf="_isFieldSorted('color') && _isAscendingSortOrder('color')"></kds-icon-up-arrow>
              <kds-icon-down-arrow *ngIf="_isFieldSorted('color') && !_isAscendingSortOrder('color')">
              </kds-icon-down-arrow>
            </th>
            <th [pSortableColumn]="'year'">Year
              <kds-icon-sort *ngIf="!_isFieldSorted('year')"></kds-icon-sort>
              <kds-icon-up-arrow *ngIf="_isFieldSorted('year') && _isAscendingSortOrder('year')"></kds-icon-up-arrow>
              <kds-icon-down-arrow *ngIf="_isFieldSorted('year') && !_isAscendingSortOrder('year')">
              </kds-icon-down-arrow>
            </th>
            <th [pSortableColumn]="'vin'">VIN
              <kds-icon-sort *ngIf="!_isFieldSorted('vin')"></kds-icon-sort>
              <kds-icon-up-arrow *ngIf="_isFieldSorted('vin') && _isAscendingSortOrder('vin')"></kds-icon-up-arrow>
              <kds-icon-down-arrow *ngIf="_isFieldSorted('vin') && !_isAscendingSortOrder('vin')">
              </kds-icon-down-arrow>
            </th>
            <th [pSortableColumn]="''">
          </tr>
        </ng-template>
        <ng-template pTemplate="body" let-car>
          <tr class="ers-data-row">
            <td>{{car['make']}}</td>
            <td>{{car['model']}}</td>
            <td>{{car['color']}}</td>
            <td>{{car['year']}}</td>
            <td>{{car['vin']}}</td>
            <td>
              <kds-button kind="secondary" name="do" value="thing" onClick="{() => alert('ðŸŽ‰ You did the thing! ðŸŽŠ')}">
                <kds-icon-edit></kds-icon-edit>
              </kds-button>
              <kds-button kind="secondary" name="do" value="thing" onClick="{() => alert('ðŸŽ‰ You did the thing! ðŸŽŠ')}">
                <kds-icon-trash></kds-icon-trash>
              </kds-button>
            </td>
          </tr>
        </ng-template>
        <ng-template pTemplate="emptymessage" let-columns>
          <tr>
            <td colspan="6">
              No records found
            </td>
          </tr>
        </ng-template>
      </p-table>
      <ers-paginator class="paginator-bottom" [currentPage]="1" [items]="(page | async)?.data.cars"
        [totalItems]="(page | async)?.meta.totalElements || 1" [itemsPerPageList]="paginatorOptions.itemsPerPageList"
        [itemsPerPageDropdown]="paginatorOptions.itemsPerPageDropdown" [itemsPerPage]="paginatorOptions.itemsPerPage"
        [itemsPerPageList]="paginatorOptions.itemsPerPageList" [displayTotalItems]="paginatorOptions.displayTotalItems"
        [displayItemsPerPage]="paginatorOptions.displayItemsPerPage" (pageChanged)="_handlePageChange($event)">
      </ers-paginator>
    </div>
  </div>
  <p-dialog header="Upload Cars" [(visible)]="displayUpload" [style]="{width: '300px'}">
    <p>Download the XLS template <a href="../../../assets/car_template.xlsx" target="_blank">here.</a></p>
    <input type="file" (change)="onFileChange($event)" />
    <br />
    <form class="row" novalidate [formGroup]="importForm" (submit)="saveUpload()">
      <ul class="list-group">
        <li class="list-group-item" formArrayName="orders"
          *ngFor="let order of importForm.controls.orders.controls; let i = index">
          <kds-label class="mb-8">
            <kds-checkbox class="mr-8" [formControlName]="i"></kds-checkbox>
            {{ newUploadRecords[i].make }} {{ newUploadRecords[i].model }}
          </kds-label>
        </li>
      </ul>
      <kds-button kind="primary" type="submit" [disabled]="!newUploadRecords">
        Save selected
      </kds-button>
      <kds-button kind="cancel" (click)="displayUpload=false">
        Cancel
      </kds-button>
    </form>
  </p-dialog>
